<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>My Score Keeper</title>
    <base href="/" />
    <link href="_content/MyScoreBoardShared/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/app.css" />
    <!-- shared styles from MyScoreBoardShared -->
    <link rel="stylesheet" href="_content/MyScoreBoardShared/css/app.css" />
    <link rel="stylesheet" href="MyScoreBoardMaui.styles.css" />
    <link rel="icon" href="data:,">
</head>

<body>

    <div id="nav-backdrop" class="nav-backdrop"></div>
    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>

    <script src="_content/MyScoreBoardShared/js/confetti.js"></script>
    <script src="_content/MyScoreBoardShared/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="_content/MyScoreBoardShared/js/nav.js"></script>
    <script src="_framework/blazor.webview.js" autostart="false"></script>

    <script>
        // Debug mobile menu auto-close functionality
        document.addEventListener('DOMContentLoaded', function () {
            console.log('🔍 Mobile menu script loading...');
            
            const navbarCollapse = document.getElementById('mainNav');
            const navBackdrop = document.getElementById('nav-backdrop');
            const navbarToggler = document.querySelector('.navbar-toggler');
            
            console.log('🔍 Elements found:', {
                navbarCollapse: !!navbarCollapse,
                navBackdrop: !!navBackdrop,
                navbarToggler: !!navbarToggler
            });
            
            if (!navbarCollapse) {
                console.error('❌ #mainNav not found!');
                return;
            }

            const collapse = bootstrap.Collapse.getOrCreateInstance(navbarCollapse, { toggle: false });
            let isAnimating = false;
            let isMenuOpen = false;

            // Debug debounced hide function
            let hideTimeout;
            const debouncedHide = (immediate = false) => {
                console.log('🔧 debouncedHide called, immediate:', immediate);
                clearTimeout(hideTimeout);
                const delay = immediate ? 0 : 100;
                hideTimeout = setTimeout(() => {
                    if (!isAnimating && navbarCollapse.classList.contains('show')) {
                        console.log('✅ Hiding menu');
                        collapse.hide();
                    } else {
                        console.log('⚠️ Menu hide skipped - animating:', isAnimating, 'has show class:', navbarCollapse.classList.contains('show'));
                    }
                }, delay);
            };

            // Backdrop management with debug
            const showBackdrop = () => {
                console.log('🎭 Showing backdrop');
                if (navBackdrop) {
                    navBackdrop.classList.add('show');
                    document.body.style.overflow = 'hidden';
                }
            };
            
            const hideBackdrop = () => {
                console.log('🎭 Hiding backdrop');
                if (navBackdrop) {
                    navBackdrop.classList.remove('show');
                    document.body.style.overflow = '';
                }
            };

            // Track animation state with debug
            navbarCollapse.addEventListener('show.bs.collapse', () => {
                console.log('📱 Menu opening...');
                isAnimating = true;
                isMenuOpen = true;
                showBackdrop();
            });
            
            navbarCollapse.addEventListener('shown.bs.collapse', () => {
                console.log('📱 Menu opened');
                isAnimating = false;
            });
            
            navbarCollapse.addEventListener('hide.bs.collapse', () => {
                console.log('📱 Menu closing...');
                isAnimating = true;
                isMenuOpen = false;
                hideBackdrop();
            });
            
            navbarCollapse.addEventListener('hidden.bs.collapse', () => {
                console.log('📱 Menu closed');
                isAnimating = false;
                hideBackdrop();
            });

            // Enhanced auto-close with detailed debug
            const setupAutoClose = () => {
                const allNavLinks = navbarCollapse.querySelectorAll('a[href], .nav-link');
                console.log('🔗 Found navigation links:', allNavLinks.length);
                
                allNavLinks.forEach((link, index) => {
                    console.log(`🔗 Link ${index}:`, link.href || link.textContent.trim());
                    
                    // Remove existing listeners
                    link.removeEventListener('click', handleNavClick);
                    
                    // Add click listener
                    link.addEventListener('click', handleNavClick, { passive: true });
                });
            };

            // Navigation click handler with detailed debug
            const handleNavClick = (e) => {
                const link = e.currentTarget;
                console.log('🖱️ Nav link clicked:', link.href || link.textContent.trim());
                
                // Skip dropdowns
                if (link.closest('.dropdown') && !link.href) {
                    console.log('⏭️ Skipping dropdown toggle');
                    return;
                }
                
                // Visual feedback
                link.style.transform = 'scale(0.98)';
                link.style.transition = 'transform 0.1s ease';
                
                setTimeout(() => {
                    link.style.transform = '';
                }, 100);
                
                // Auto-close with debug
                console.log('⏰ Scheduling menu close...');
                setTimeout(() => debouncedHide(), 150);
            };

            // Backdrop click debug
            if (navBackdrop) {
                navBackdrop.addEventListener('click', () => {
                    console.log('🎭 Backdrop clicked');
                    debouncedHide(true);
                }, { passive: true });
            }

            // Responsive behavior
            window.addEventListener('resize', () => {
                if (window.innerWidth > 767 && isMenuOpen) {
                    console.log('📱 Closing menu due to resize');
                    collapse.hide();
                }
            });

            // Global click listener for any nav link
            document.addEventListener('click', (e) => {
                const clickedElement = e.target.closest('a[href]');
                if (clickedElement && navbarCollapse.contains(clickedElement) && isMenuOpen) {
                    console.log('🌐 Global nav click detected:', clickedElement.href);
                    setTimeout(() => debouncedHide(), 100);
                }
            }, { passive: true });

            // Setup and observe
            setupAutoClose();
            
            // Watch for DOM changes
            const observer = new MutationObserver(() => {
                console.log('🔄 DOM changed, re-setting up auto-close');
                setupAutoClose();
            });
            
            observer.observe(navbarCollapse, {
                childList: true,
                subtree: true
            });

            console.log('✅ Mobile menu script loaded successfully');
        });
    </script>

</body>

</html>